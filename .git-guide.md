# Git Configuration Guide for k-Terminus

## Files to Commit

### Always Commit
- **`Cargo.lock`** - Ensures reproducible builds across environments (critical for binaries)
- **`pnpm-lock.yaml`** - Ensures consistent frontend dependencies
- **`pnpm-workspace.yaml`** - Defines the pnpm monorepo structure
- **`package.json`** - Project dependencies and scripts
- **Source code** - All `.rs`, `.ts`, `.tsx`, `.js`, etc.
- **Configuration** - `Cargo.toml`, `tauri.conf.json`, `tsconfig.json`, etc.
- **Documentation** - `README.md`, `CHANGELOG.md`, docs/

### Never Commit
- **`target/`** - Rust build artifacts (rebuild from Cargo.lock)
- **`node_modules/`** - Node dependencies (rebuild from pnpm-lock.yaml)
- **`dist/`** - Frontend build output
- **`.env.local`** - Local environment variables with secrets
- **`*.log`** - Log files
- **`.DS_Store`** - macOS metadata
- **`*.pid`, `*.sock`** - Runtime files

## Current Setup

### Root `.gitignore`
- Ignores Rust build artifacts (`target/`)
- Ignores Node.js dependencies (`node_modules/`)
- Ignores Tauri build outputs
- Ignores IDE and OS files
- Ignores sensitive config files (`.env*`, `*.local.toml`)

### `apps/kt-desktop/.gitignore`
- App-specific ignores (dist, coverage, etc.)
- Keeps `.vscode/extensions.json` (recommended extensions)

### `.gitattributes`
- Enforces LF line endings for cross-platform consistency
- Marks binary files appropriately
- Configured for Rust + TypeScript + Tauri project

## Common Operations

### Check what will be committed
```bash
git status
git diff --staged
```

### Stage new files
```bash
# Stage specific files
git add pnpm-lock.yaml pnpm-workspace.yaml

# Stage all new source files
git add apps/kt-desktop/src/

# Stage all changes (be careful!)
git add -A
```

### Verify .gitignore is working
```bash
# Should NOT show node_modules/, target/, etc.
git status --ignored
```

### Clean untracked files (careful!)
```bash
# Show what would be deleted
git clean -n -d

# Actually delete (use with caution)
git clean -f -d
```

## pnpm Workspace Structure

The project uses pnpm workspaces for managing the monorepo:

- **Root `package.json`** - Workspace root, defines global scripts
- **`pnpm-workspace.yaml`** - Lists workspace packages
- **`pnpm-lock.yaml`** - Lockfile for all workspace dependencies
- **Root `node_modules/`** - Shared dependencies (ignored by git)
- **`apps/kt-desktop/`** - Desktop app package

## Binary Files

Some binary files MAY be committed if needed:
- **Icons** (`.png`, `.ico`, `.icns`) in `src-tauri/icons/`
- **Images** for documentation in `docs/`
- **Fonts** if bundled with the app

Currently these are tracked appropriately.

## Troubleshooting

### "I accidentally committed node_modules/"
```bash
git rm -r --cached node_modules/
git commit -m "Remove node_modules from git"
```

### "I need to ignore a file that's already tracked"
```bash
git rm --cached path/to/file
# Then add to .gitignore
git commit -m "Stop tracking file"
```

### "My lockfile changed unexpectedly"
```bash
# Restore it
git checkout pnpm-lock.yaml

# Or if you want the changes
git add pnpm-lock.yaml
git commit -m "Update dependencies"
```

### "Line ending issues on Windows"
The `.gitattributes` file enforces LF endings. If you see warnings:
```bash
git add --renormalize .
git commit -m "Normalize line endings"
```
